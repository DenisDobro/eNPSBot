# eNPSBot

Телеграм-мини-приложение для сбора еженедельного внутреннего NPS в проектных командах Металампа. Сервис позволяет сотрудникам отвечать на стандартизированную анкету, автоматически сохраняет каждый ответ и дает возможность анализировать историю по каждому проекту.

## Возможности

- авторизация сотрудников через Telegram Web App (init data);
- единый каталог проектов с поиском и быстрым добавлением новых записей;
- пошаговая анкета из 10 вопросов c автоматическим сохранением после каждого ответа;
- история отправленных форм с пометкой о доступности редактирования в течение 24 часов;
- дизайн в фирменном стиле Металампа и встроенный режим администратора для проектного офиса.

## Технологии

- **Backend:** Node.js, Express, SQLite (better-sqlite3), TypeScript;
- **Frontend:** React + Vite + TypeScript, Telegram Web Apps API;
- **Валидация:** Zod;
- **Стили:** кастомные компоненты и CSS без дополнительных библиотек.

## Подготовка окружения

1. Склонируйте репозиторий и установите зависимости проекта:

   ```bash
   npm install
   cd client && npm install && cd ..
   ```

2. Настройте переменные окружения (см. `.env.example`). Минимально необходим токен бота Telegram для валидации `initData`:

   ```bash
   cp .env.example .env
   # заполните BOT_TOKEN и при необходимости остальные параметры
   ```

   Для локальной разработки без Telegram можно задать `ALLOW_INSECURE_INIT_DATA=true` и передавать фиктивного пользователя через заголовок `x-debug-user`. Переменная `ADMIN_TOKEN` требуется для доступа к административному API и встраиваемой панели аналитики.

3. При первом запуске файл базы данных SQLite создается автоматически. По умолчанию он располагается в `data/enps.sqlite`, путь можно изменить через `DATABASE_FILE`.

## Локальный запуск

Запустите API и фронтенд в отдельных терминалах или воспользуйтесь общим скриптом:

```bash
# терминал 1 — backend
npm run dev

# терминал 2 — frontend
npm run client:dev

# или одна командa для обоих процессов
npm run dev:all
```

Vite настроен на проксирование запросов `/api` на `http://localhost:3000`, поэтому интерфейс будет доступен на `http://localhost:5173`.

### Сборка продакшн-версии

```bash
npm run build            # компиляция сервера и сборка фронтенда в client/dist
npm start                # запуск Express, который раздает статический бандл
# для удобства можно использовать npm run launch (build + start)
```

Express автоматически обслуживает собранный фронтенд из каталога `client/dist`. Если нужно собрать только серверную часть, выполните `npm run build:server`.

## Структура БД

- `users` — сотрудники Telegram, прошедшие авторизацию;
- `projects` — список проектов компании;
- `surveys` — ответы на анкету, уникальные по пользователю, проекту и дате.

Ответы сохраняются сразу после каждого вопроса, а редактирование возможно в течение 24 часов с момента создания записи.

## Тесты и проверки

Перед отправкой изменений выполните:

```bash
npm run lint          # проверка TypeScript для backend
npm run client:lint   # ESLint + TypeScript для фронтенда
npm run build         # полный билд сервера и фронтенда
npm run client:build  # сборка интерфейса отдельно
```

## Лицензия

Проект распространяется под лицензией ISC.
