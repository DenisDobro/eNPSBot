# eNPSBot

Телеграм-мини-приложение для сбора еженедельного внутреннего NPS в проектных командах Металампа. Сервис позволяет сотрудникам отвечать на стандартизированную анкету, автоматически сохраняет каждый ответ и дает возможность анализировать историю по каждому проекту.

## Возможности

- авторизация сотрудников через Telegram Web App (init data);
- единый каталог проектов с поиском и быстрым добавлением новых записей;
- пошаговая анкета из 10 вопросов c автоматическим сохранением после каждого ответа;
- история отправленных форм с пометкой о доступности редактирования в течение 24 часов;
- дизайн в фирменном стиле Металампа, адаптивный интерфейс для мобильных устройств.

## Технологии

- **Backend:** Node.js, Express, SQLite (better-sqlite3), TypeScript;
- **Frontend:** React + Vite + TypeScript, Telegram Web Apps API;
- **Валидация:** Zod;
- **Стили:** кастомные компоненты, CSS без дополнительных библиотек.

## Подготовка окружения

1. Склонируйте репозиторий и установите зависимости проекта:

   ```bash
   npm install
   cd client && npm install && cd ..
   ```

2. Настройте переменные окружения (см. `.env.example`). Минимально необходим токен бота Telegram для валидации `initData`:

   ```bash
   cp .env.example .env
   # отредактируйте BOT_TOKEN и при необходимости остальные параметры
   ```

   Для локальной разработки без Telegram можно задать `ALLOW_INSECURE_INIT_DATA=true` и передавать фиктивного пользователя через заголовок `x-debug-user`.

3. Примените миграции (создание таблиц происходит автоматически при первом запуске).

## Локальный запуск

Запустите API и фронтенд в отдельных терминалах:

```bash
# терминал 1 — backend
npm run dev

# терминал 2 — frontend
npm run client:dev
```

Vite настроен на проксирование запросов `/api` на `http://localhost:3000`, поэтому интерфейс будет доступен на `http://localhost:5173`.

### Сборка продакшн-версии

```bash
npm run build            # компиляция сервера
npm run client:build     # сборка фронтенда в client/dist
npm start                # запуск Express, который раздает статический бандл
```

Готовые файлы фронтенда автоматически обслуживаются Express из каталога `client/dist`.

## Структура БД

- `users` — сотрудники Telegram, прошедшие авторизацию;
- `projects` — список проектов компании;
- `surveys` — ответы на анкету, уникальные по пользователю, проекту и дате.

Ответы сохраняются сразу после каждого вопроса, а редактирование возможно в течение 24 часов с момента создания записи.

## Тесты и проверки

Перед отправкой изменений выполните:

```bash
npm run lint          # проверка TypeScript для backend
npm run client:lint   # ESLint + TypeScript для фронтенда
npm run build         # сборка сервера
npm run client:build  # сборка интерфейса
```

## Лицензия

Проект распространяется под лицензией ISC.
