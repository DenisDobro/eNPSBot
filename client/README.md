# Клиентское приложение eNPSBot

React/Vite-приложение реализует Telegram-миниапп для заполнения внутреннего NPS. Ниже краткое описание архитектуры и ключевых модулей фронтенда.

## Структура каталогов

- `app/` — точка входа UI: инициализация Telegram WebApp, загрузка фич-флагов, композиция экранов.
- `features/` — функциональные блоки (проекты, анкета, история ответов) с собственными компонентами и хуками.
- `shared/` — переиспользуемые части: API-клиент, типы, хук работы с темой Металампа, интеграция с Telegram.

## API-клиент

`shared/api/httpClient.ts` создает экземпляр клиента, автоматически прокидывающий `x-telegram-init-data` или `x-debug-user`. Остальные модули (`projects.ts`, `surveys.ts`, `featureFlags.ts`) предоставляют типизированные обертки над REST-эндпоинтами.

## Работа с Telegram

`shared/telegram/useTelegramAuth.ts` инициализирует WebApp, расширяет окно и достает данные пользователя. В отсутствие Telegram-контекста подставляется тестовый пользователь (активируется в отладочном режиме, когда на сервере включен `ALLOW_INSECURE_INIT_DATA`).

Цветовая схема управляется хуком `shared/hooks/useMetalampTheme.ts`, синхронизированным с системными настройками и событиями Telegram.

## Фич-флаги на клиенте

`app/hooks/useFeatureFlags.ts` загружает конфигурацию с бэкенда (`/api/feature-flags`) и сохраняет ее в состоянии приложения. Флаги влияют на показ аналитики, доступность создания проектов и редактирования ответов.

## Хуки доменных областей

- `features/projects/hooks/useProjects.ts` — поиск и выбор проектов с локальным кешом, debounce-поиском и созданием новых записей.
- `features/surveys/hooks/useSurveyWorkflow.ts` — загрузка истории, создание ежедневной анкеты и пошаговое сохранение ответов.

Оба хука принимают `HttpClient` и контролируются фич-флагами, поэтому бизнес-логика остается концентрированной и переиспользуемой.

## Запуск и сборка

Фронтенд стартует через `npm run client:dev`. Продакшн-сборка выполняется скриптом `npm run client:build` (автоматически вызывается при `npm run build` в корне).
